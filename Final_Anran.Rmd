---
title: "Final_Anran"
output: html_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(plotly)
library(ggplot2)


knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 6,
  out.width = "90%"
)

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

## load in data

```{r}
hectare = read_csv("./data/2018_Central_Park_Squirrel_Census_-_Hectare_Data.csv") %>% 
janitor::clean_names()
skimr::skim(hectare)
```


#### based on hectare, observe the characteristics of squirrels.  
litter, 



## clean the dataset. 

```{r}
numextract <- function(string){ 
  str_extract(string, "\\-*\\d+\\.*\\d*")
}

hectare = 
  hectare %>% 
  mutate(
      temperature_fahrenheit = numextract(sighter_observed_weather_data),
      rate = number_of_squirrels/total_time_of_sighting
)
```


### temperature plot

```{r}
temperature_df =   
hectare %>%   
  filter(temperature_fahrenheit > 29) %>% 
  mutate(
    temperature_fahrenheit = recode(temperature_fahrenheit, `-50` = "50"),
    temperature_category = ifelse(temperature_fahrenheit <= "50", "below 50",
                           ifelse("50"< temperature_fahrenheit & temperature_fahrenheit<= "60", "50-60",
                             ifelse("60"< temperature_fahrenheit & temperature_fahrenheit<= "70", "60-70",
                               ifelse("70"< temperature_fahrenheit, "above 70","others")))),
    temperature_category = as.factor(temperature_category)
 ) %>% 
  plot_ly( y = ~rate, color = ~temperature_category, type = "box", colors = "Set3")

temperature_df

```

### condition and litter plot 


```{r}
plot_condition_litter = 
  hectare %>% 
  select(hectare_conditions, litter,rate) %>%
  na.omit() %>% 
  ggplot(aes(x = hectare_conditions, y = rate, fill = litter)) +
  geom_bar(stat = "identity", position = "fill") + 
  labs(
    title = "Distribution of datavalues for each response in 2006 and 2010 among locations in NY" 
  )
plot_condition_litter 
```


```{r,error=TRUE}
sunburst = 
  hectare %>% 
  select(hectare_conditions, litter, rate) %>% 
  na.omit() %>% 
mutate(
  rate = round(sunburst$rate,digits = 2)
) %>% 
  
  
df = 
  sunburst %>%
  group_by(hectare_conditions, rate) %>% 
  summarize(
    sum = sum(rate)

  )

p <- plot_ly(
  labels = c("Eve", "Cain", "Seth", "Enos", "Noam", "Abel", "Awan", "Enoch", "Azura"),
  parents = c("", "Eve", "Eve", "Seth", "Seth", "Eve", "Eve", "Awan", "Eve"),
  values = c(10, 14, 12, 10, 2, 6, 6, 4, 4),
  type = 'sunburst'
)
```








temperature = 
  hectare %>% 
  filter(temperature_fahrenheit > 29) %>% 
  select(sighter_observed_weather_data, temperature_fahrenheit) %>% 
  na.omit()
  count(temperature, temperature_fahrenheit) %>% view()



levels(as.factor(hectare$temperature_fahrenheit))
levels(as.factor(hectare$litter))  ## Abundant, None, Some. 
levels(as.factor(hectare$hectare_conditions)) # "Busy""Calm""Calm, Busy" "Medium"     "Moderate"  
> 
  
  
  
#################################################
#######################################################


   separate(date, into = c('day','year'), sep = 4) %>% 
   separate(day, into = c('month','date'), sep = 2) %>% 

## sum of the squirrels for each day. 
sum = 
hectare %>% 
  group_by(date) %>% 
  summarise(
    sum = sum(number_of_squirrels)
  )

## weather clean 
clean = 
hectare %>% 
  select(sighter_observed_weather_data) %>% 
  mutate(
    weather = 
        gsub("[^a-zA-Z]", "",hectare$sighter_observed_weather_data)
      ) 

rainy = 
  clean %>% 
  filter(str_detect(weather, "ain")) %>% 
  mutate(
    weather = "Rainy"
  )

sunny = 
  clean %>% 
  filter(str_detect(weather, "un")) %>% 
  mutate(
    weather = "Sunny"
  )

  

levels(as.factor(hectare$sighter_observed_weather_data))

```






## draft for cleaning weather, but error. 

```{r, error = TRUE}
numextract <- function(string){ 
  str_extract(string, "\\-*\\d+\\.*\\d*")
}
 mutate(
     Weather = ifelse(str_detect(sighter_observed_weather_data,c("sun", "Sun")) == "TRUE", "Sunny",
              ifelse(str_detect(sighter_observed_weather_data,c("cloud", "Cloud")) == "TRUE",
 "Cloudy", 
              ifelse(str_detect(sighter_observed_weather_data,c("Windy", "wind")) == "TRUE", "Windy",
                      "Others")))
    ) %>% 
```






 
